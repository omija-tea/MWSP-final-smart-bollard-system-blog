{% extends 'bollard/base.html' %}

{% block title %}ë³¼ë¼ë“œ ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block content %}
<!-- í˜„ì¬ ìƒíƒœ ì¹´ë“œ -->
<div class="card">
    <h2>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h2>
    <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; text-align: center;">
        <div
            style="padding: 20px; background: {% if state.is_closed %}#f8d7da{% else %}#d4edda{% endif %}; border-radius: 10px;">
            <div style="font-size: 2em;">{% if state.is_closed %}ğŸ”’{% else %}ğŸ”“{% endif %}</div>
            <div style="font-weight: bold; margin-top: 10px;">
                {% if state.is_closed %}ë‹«í˜{% else %}ì—´ë¦¼{% endif %}
            </div>
        </div>
        <div
            style="padding: 20px; background: {% if state.manual_mode %}#fff3cd{% else %}#cce5ff{% endif %}; border-radius: 10px;">
            <div style="font-size: 2em;">{% if state.manual_mode %}ğŸ®{% else %}ğŸ¤–{% endif %}</div>
            <div style="font-weight: bold; margin-top: 10px;">
                {% if state.manual_mode %}ìˆ˜ë™ ëª¨ë“œ{% else %}ìë™ ëª¨ë“œ{% endif %}
            </div>
        </div>
        <div
            style="padding: 20px; background: {% if setting.is_active %}#d4edda{% else %}#f8d7da{% endif %}; border-radius: 10px;">
            <div style="font-size: 2em;">{% if setting.is_active %}âœ…{% else %}â¹ï¸{% endif %}</div>
            <div style="font-weight: bold; margin-top: 10px;">
                {% if setting.is_active %}ì‹œìŠ¤í…œ í™œì„±{% else %}ì‹œìŠ¤í…œ ë¹„í™œì„±{% endif %}
            </div>
        </div>
    </div>
</div>

<!-- ì„¤ì • ìš”ì•½ -->
<div class="card">
    <h2>âš™ï¸ í˜„ì¬ ì„¤ì •</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px;">ì ìœ ìœ¨ ê¸°ì¤€</td>
            <td style="padding: 10px; font-weight: bold;">{{ setting.occupy_ratio }}%</td>
        </tr>
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px;">ìœ ì§€ í”„ë ˆì„</td>
            <td style="padding: 10px; font-weight: bold;">{{ setting.maintain_frame }}</td>
        </tr>
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px;">ê°ì§€ ëŒ€ìƒ</td>
            <td style="padding: 10px; font-weight: bold;">Class ID {{ setting.target_object }} (ì˜¤í† ë°”ì´)</td>
        </tr>
        <tr>
            <td style="padding: 10px;">ë¼ì¦ˆë² ë¦¬íŒŒì´</td>
            <td style="padding: 10px; font-weight: bold;">{{ setting.raspberry_pi_host }}:{{ setting.raspberry_pi_port
                }}</td>
        </tr>
    </table>
</div>

<!-- ìµœê·¼ ê°ì§€ ë¡œê·¸ -->
<div class="card">
    <h2>ğŸ“œ ìµœê·¼ ì´ë²¤íŠ¸ ë¡œê·¸</h2>
    {% if recent_logs %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                <th style="padding: 10px; text-align: left;">ì‹œê°„</th>
                <th style="padding: 10px; text-align: left;">ê°ì§€</th>
                <th style="padding: 10px; text-align: left;">ì ìœ ìœ¨</th>
                <th style="padding: 10px; text-align: left;">ë™ì‘</th>
            </tr>
        </thead>
        <tbody>
            {% for log in recent_logs %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">{{ log.timestamp|date:"m/d H:i:s" }}</td>
                <td style="padding: 10px;">
                    {% if log.detected %}
                    <span style="color: #dc3545;">âš ï¸ ê°ì§€</span>
                    {% else %}
                    <span style="color: #28a745;">âœ… ë¯¸ê°ì§€</span>
                    {% endif %}
                </td>
                <td style="padding: 10px;">{{ log.occupy_ratio_actual|floatformat:1 }}%</td>
                <td style="padding: 10px;">
                    {% if log.action == 'open' %}
                    <span style="color: #28a745;">ğŸ”“ ì—´ë¦¼</span>
                    {% elif log.action == 'close' %}
                    <span style="color: #dc3545;">ğŸ”’ ë‹«í˜</span>
                    {% else %}
                    <span style="color: #6c757d;">â€” ë³€í™”ì—†ìŒ</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666; text-align: center; padding: 20px;">
        ì•„ì§ ê°ì§€ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.
    </p>
    {% endif %}
</div>

<!-- ë¹ ë¥¸ ì•¡ì…˜ -->
<div class="card">
    <h2>âš¡ ë¹ ë¥¸ ì•¡ì…˜</h2>
    <div class="button-group">
        <a href="{% url 'bollard_setting' %}" class="btn btn-primary">âš™ï¸ ì„¤ì • ë³€ê²½</a>
        <a href="{% url 'post_list' %}" class="btn btn-secondary">ğŸ“¸ ë¸”ë¡œê·¸ ë³´ê¸°</a>
    </div>
</div>
{% endblock %}