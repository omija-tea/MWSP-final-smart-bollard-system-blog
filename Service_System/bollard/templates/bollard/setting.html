{% extends 'bollard/base.html' %}

{% block title %}ë³¼ë¼ë“œ ì„¤ì •{% endblock %}

{% block content %}
{% if message %}
<div class="message success">{{ message }}</div>
{% endif %}

{% if system_status == "stop" %}
<form method="post">
    {% csrf_token %}

    <!-- ë³¼ë¼ë“œ ìˆ˜ë™ ì¡°ì‘ -->
    <div class="card">
        <h2>ğŸ® ë³¼ë¼ë“œ ìˆ˜ë™ ì¡°ì‘</h2>
        <div class="button-group">
            <button type="submit" name="action" value="bopen" class="btn btn-success">
                ğŸ”“ ë³¼ë¼ë“œ ì—´ê¸°
            </button>
            <button type="submit" name="action" value="bclose" class="btn btn-danger">
                ğŸ”’ ë³¼ë¼ë“œ ë‹«ê¸°
            </button>
        </div>
    </div>

    <!-- ì„œë²„ ì„¤ì • -->
    <div class="card">
        <h2>âš™ï¸ ì„œë²„ ì„¤ì •</h2>

        <div class="form-group">
            <label for="occupy_ratio">ì˜¤í† ë°”ì´ ì°¨ì§€ ì˜ì—­ í¼ì„¼íŠ¸ (%)</label>
            <input type="number" id="occupy_ratio" name="occupy_ratio" placeholder="{{ setting.occupy_ratio }}"
                value="{{ setting.occupy_ratio }}" min="1" max="100">
        </div>

        <div class="form-group">
            <label for="maintain_frame">ë³¼ë¼ë“œ íì‡„ ìœ ì§€ í”„ë ˆì„</label>
            <input type="number" id="maintain_frame" name="maintain_frame" placeholder="{{ setting.maintain_frame }}"
                value="{{ setting.maintain_frame }}" min="1">
        </div>

        <div class="form-group">
            <label for="target_object">ê°ì§€ëŒ€ìƒ ë²ˆí˜¸ (COCO Class ID)</label>
            <input type="number" id="target_object" name="target_object" value="{{ setting.target_object }}" min="0">
            <small style="color: #666;">3 = ì˜¤í† ë°”ì´ (motorcycle)</small>
        </div>

        <div class="button-group">
            <button type="submit" name="action" value="server" class="btn btn-primary">
                ğŸ’¾ ì„¤ì • ì €ì¥
            </button>
        </div>
    </div>

    <!-- ì‹œìŠ¤í…œ êµ¬ë™ -->
    <div class="card">
        <h2>ğŸš€ ì‹œìŠ¤í…œ êµ¬ë™</h2>
        <div class="button-group">
            <button type="submit" name="action" value="run_bollard" class="btn btn-success">
                â–¶ï¸ ì‹œìŠ¤í…œ ì‹œì‘
            </button>
        </div>
    </div>

    <!-- ë¡œê·¸ì•„ì›ƒ -->
    <div class="card">
        <div class="button-group">
            <a href="{% url 'admin:logout' %}" class="btn btn-secondary">
                ğŸšª ë¡œê·¸ì•„ì›ƒ
            </a>
        </div>
    </div>
</form>

{% else %}
<!-- ì‹œìŠ¤í…œ ë™ì‘ ì¤‘ -->
<form method="post">
    {% csrf_token %}

    <div class="card">
        <h2>
            ğŸš§ ë³¼ë¼ë“œ ë™ì‘ì¤‘
            <span class="status-indicator status-running">RUNNING</span>
        </h2>

        <p style="margin-bottom: 20px; color: #666;">
            í˜„ì¬ ì‹œìŠ¤í…œì´ ìë™ ëª¨ë“œë¡œ ë™ì‘ ì¤‘ì…ë‹ˆë‹¤.<br>
            ì˜¤í† ë°”ì´ ê°ì§€ ì‹œ ìë™ìœ¼ë¡œ ë³¼ë¼ë“œê°€ ì œì–´ë©ë‹ˆë‹¤.
        </p>

        <div class="button-group">
            <button type="submit" name="action" value="stop_bollard" class="btn btn-danger">
                â¹ï¸ ì‹œìŠ¤í…œ ì •ì§€
            </button>
        </div>
    </div>
</form>
{% endif %}

<!-- í˜„ì¬ ìƒíƒœ ì •ë³´ -->
<div class="card">
    <h2>ğŸ“Š í˜„ì¬ ìƒíƒœ</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px; font-weight: bold;">ë³¼ë¼ë“œ ìƒíƒœ</td>
            <td style="padding: 10px;">
                {% if state.is_closed %}
                <span style="color: #dc3545;">ğŸ”’ ë‹«í˜</span>
                {% else %}
                <span style="color: #28a745;">ğŸ”“ ì—´ë¦¼</span>
                {% endif %}
            </td>
        </tr>
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px; font-weight: bold;">ì œì–´ ëª¨ë“œ</td>
            <td style="padding: 10px;">
                {% if state.manual_mode %}
                <span style="color: #ffc107;">âš ï¸ ìˆ˜ë™</span>
                {% else %}
                <span style="color: #667eea;">ğŸ¤– ìë™</span>
                {% endif %}
            </td>
        </tr>
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px; font-weight: bold;">ìœ ì§€ í”„ë ˆì„ ì¹´ìš´í„°</td>
            <td style="padding: 10px;">{{ state.counter }}</td>
        </tr>
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px; font-weight: bold;">ì ìœ ìœ¨ ê¸°ì¤€</td>
            <td style="padding: 10px;">{{ setting.occupy_ratio }}%</td>
        </tr>
        <tr>
            <td style="padding: 10px; font-weight: bold;">ë¼ì¦ˆë² ë¦¬íŒŒì´ ì£¼ì†Œ</td>
            <td style="padding: 10px;">{{ setting.raspberry_pi_host }}:{{ setting.raspberry_pi_port }}</td>
        </tr>
    </table>
</div>
{% endblock %}